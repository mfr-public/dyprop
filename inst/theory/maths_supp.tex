\documentclass[11pt, a4paper]{article}

% --- PREAMBLE ---
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{amsmath, amssymb, amsfonts} % Core math packages
\usepackage{geometry} % Page layout
\usepackage{graphicx} % For images 
\usepackage{hyperref} % For hyperlinks
\usepackage[numbers]{natbib}   % For citation management
\usepackage{enumitem} % For better list formatting
\usepackage{bm}       % For bold math symbols

% Geometry settings
\geometry{
  top=2.5cm,
  bottom=2.5cm,
  left=2.5cm,
  right=2.5cm
}

% Hyperlink setup
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    citecolor=blue,
    urlcolor=blue
}

% Title setup
\title{\textbf{Supplementary Note 1: Mathematical Principles of Dynamic Proportionality}}
\author{DyProp Development Team}
\date{\today}

\begin{document}

\maketitle

\begin{abstract}
This supplementary note provides the rigorous mathematical derivations underpinning the Dynamic Proportionality (\texttt{dyprop}) framework. We define the geometric constraints of the simplex, the zero-handling imputation protocols, and the CoDa-safe robustness transformations. Furthermore, we derive the vectorized kernel-weighted covariance algebra for continuous trajectory analysis and the Singular Perturbation solutions for mechanistic boundary function modeling. Finally, we map these metrics to Dynamical Systems Theory, reinterpreting proportionality instability as a loss of regulatory stiffness on a potential landscape.
\end{abstract}

\section{The Geometry of Compositional Data}

\subsection{The Simplex and the Closure Problem}
Genomic count data (e.g., scRNA-seq, scDNA-seq, metagenomics) are inherently compositional. The observed count vector $\mathbf{x}_i$ for a cell $i$ is strictly constrained by the arbitrary sequencing depth (library size). Consequently, the data does not reside in Euclidean space ($\mathbb{R}^p$), but in the \textbf{Simplex} ($S^p$).

\begin{equation}
S^p = \left\{ \mathbf{x} \in \mathbb{R}^p \mid x_j > 0, \sum_{j=1}^p x_j = \kappa \right\}
\end{equation}

\noindent\textbf{Where:}
\begin{itemize}
    \item $\mathbf{x} = [x_1, \dots, x_p]$ is the vector of observed counts for $p$ features.
    \item $\kappa$ is the library size constraint (sum constraint), which varies per cell.
\end{itemize}

As proven by \citet{aitchison1986}, applying standard statistical operations (such as Pearson correlation or Euclidean distance) directly to $S^p$ yields spurious negative associations, known as the ``Closure Bias''. To perform valid statistical analysis, we must project the data from $S^p$ to $\mathbb{R}^p$ using an isomorphic transformation.

\subsection{The Centered Log-Ratio (CLR) Transformation}
We utilize the Centered Log-Ratio (CLR) transformation to project the composition into Euclidean space while preserving the geometric relationships between features.

\begin{equation}
\text{clr}(\mathbf{x}) = \left[ \ln\frac{x_1}{g(\mathbf{x})}, \ln\frac{x_2}{g(\mathbf{x})}, \dots, \ln\frac{x_p}{g(\mathbf{x})} \right]
\end{equation}

\noindent\textbf{Where:}
\begin{itemize}
    \item $g(\mathbf{x}) = \left(\prod_{j=1}^p x_j\right)^{1/p}$ is the geometric mean of the composition vector.
\end{itemize}

\textbf{Theorem 1 (Log-Ratio Invariance):} A crucial property for our framework is that the ratio between any two features $j$ and $k$ in CLR space is identical to the log-ratio of their raw abundances, as the denominator $g(\mathbf{x})$ cancels out.

\begin{equation}
\text{clr}(x_j) - \text{clr}(x_k) = \ln\left(\frac{x_j}{g(\mathbf{x})}\right) - \ln\left(\frac{x_k}{g(\mathbf{x})}\right) = \ln\left(\frac{x_j}{x_k}\right)
\end{equation}

This identity allows us to compute stoichiometric dynamics efficiently using vector operations on the transformed matrix.

\section{Zero Handling and Robustness Protocols}

The logarithmic nature of Eq. (2) requires strictly positive data ($x_j > 0$). Furthermore, single-cell data contains extreme outliers (e.g., PCR artifacts) that must be managed without violating the geometry of the simplex.

\subsection{Technical Dropout (Sporadic Zeros)}
Zeros resulting from low capture efficiency are modeled as missing data. We apply \textbf{k-Nearest Neighbor (kNN) Pooling} in the reduced Principal Component space to recover these values.

\begin{equation}
\tilde{x}_{ij} = \frac{1}{K} \sum_{m \in \mathcal{N}_K(i)} x_{mj}
\end{equation}

\noindent\textbf{Where:}
\begin{itemize}
    \item $\mathcal{N}_K(i)$ is the set of $K$ nearest neighbors to cell $i$ (default $K=5$).
\end{itemize}
This step smooths technical noise but preserves biological silencing if the entire neighborhood is consistently silent.

\subsection{Biological Silencing (Rounded Zeros)}
Zeros representing true biological absence are treated as \textbf{Rounded Zeros}---values that exist below the Limit of Detection ($\delta$). We impute these using \textbf{Geometric Bayesian Multiplicative Replacement (GBM)} to preserve the covariance structure \citep{martin2015}.

\begin{equation}
x_{ij}^* = \begin{cases} 
\mathbb{E}[x_{ij} \mid x_{ij} < \delta] & \text{if } x_{ij} = 0 \\ 
x_{ij} \cdot \left(1 - \frac{\sum_{z \in \mathcal{Z}} x_{iz}^*}{\kappa}\right) & \text{if } x_{ij} > 0 
\end{cases}
\end{equation}

\subsection{Ratio-First Robustness (CoDa-Safe Winsorization)}
Standard outlier removal (e.g., clipping the counts matrix) violates Subcompositional Coherence by altering the geometric mean $g(\mathbf{x})$ non-linearly. To maintain rigor, we apply robustness protocols only \textit{after} the ratio transformation.

Let $\mathbf{y}_{jk} \in \mathbb{R}^n$ be the vector of log-ratios between features $j$ and $k$:
\begin{equation}
    \mathbf{y}_{jk} = \text{clr}(\mathbf{x}_j) - \text{clr}(\mathbf{x}_k)
\end{equation}
We apply Winsorization (clipping top/bottom 1\% quantiles) directly to $\mathbf{y}_{jk}$. Since $\mathbf{y}_{jk}$ represents coordinates in Euclidean space, this operation is mathematically equivalent to robust regression and preserves the compositional integrity of the input features.

\section{Dynamic Proportionality: The Kernel Framework}

Standard compositional methods assume static relationships. To model dynamics, we introduce a continuous pseudotime coordinate $t \in [0,1]$ and derive the \textbf{Instantaneous Weighted Covariance}.

\subsection{Kernel Weighting}
We define a Gaussian weight vector $\mathbf{w}(t_0)$ for a specific evaluation timepoint $t_0$:
\begin{equation}
w_i(t_0) = \exp\left( -\frac{(t_i - t_0)^2}{2h^2} \right)
\end{equation}

\subsection{Dynamic Instability ($\Phi$)}
We define $\Phi(t)$ as the magnitude of proportionality deviation relative to the variance of the reference feature. A spike in $\Phi(t)$ indicates a \textbf{Loss of Restoring Force} (Decoupling).

\begin{equation}
\Phi_{jk}(t) = \frac{\text{var}_w(\log(x_j/x_k))_t}{\text{var}_w(\text{clr}(x_j))_t}
\end{equation}

\section{Mechanistic Modeling: Vectorized Basis Projection}

For gene pairs exhibiting significant $\Phi(t)$ dynamics, we model the transition mechanism using \textbf{Singular Perturbation Theory} \citep{verhulst1838}. Rather than iterative non-linear regression, we employ a high-performance \textbf{Vectorized Basis Projection}.

\subsection{The Boundary Function}
We define the log-ratio $y(t)$ as a state variable transitioning between equilibria $\theta_A$ and $\theta_B$ via first-order kinetics:
\begin{equation}
\frac{dy}{dt} = \frac{1}{\epsilon \Delta\theta} (y - \theta_A)(\theta_B - y)
\end{equation}
The explicit solution is the Generalized Logistic Function:
\begin{equation}
\mu(t) = \theta_A + \frac{\theta_B - \theta_A}{1 + \exp\left(-\frac{t - \tau}{\epsilon}\right)}
\end{equation}
where $\tau$ is the Tipping Point and $\epsilon$ is the Inverse Sharpness.

\subsection{Vectorized Convolution and the Nyquist Criterion}
We generate a dictionary matrix $\mathcal{M}$ of archetypal boundary functions spanning the topological parameter space. To guarantee signal capture, the grid resolution $\Delta\tau_{grid}$ is coupled to the detection limit via the \textbf{Nyquist Sampling Criterion}:
\begin{equation}
    \Delta\tau_{grid} \le \epsilon_{min}
\end{equation}
The similarity between the observed log-ratio trajectory vector $\mathbf{y}$ and the basis dictionary $\mathcal{M}$ is computed via the dot product:
\begin{equation}
    \mathbf{r} = \mathbf{y} \cdot \mathcal{M}^T
\end{equation}
The index $i$ maximizing $\mathbf{r}$ identifies the discrete ``Best Fit Archetype''.

\subsection{Quadratic Sub-Grid Interpolation}
To recover continuous parameter estimates from the discrete grid, we apply Parabolic Interpolation. Given the maximum score $R_i$ and its neighbors $R_{i-1}, R_{i+1}$, the continuous peak $\hat{\tau}$ is derived as:
\begin{equation}
    \hat{\tau} = \tau_i + \frac{1}{2} \Delta\tau \frac{R_{i-1} - R_{i+1}}{R_{i-1} - 2R_i + R_{i+1}}
\end{equation}
This yields infinite precision for the Tipping Point without iterative optimization.

\section{The Physics of Regulation: Landscape Dynamics}

\subsection{Landscape Curvature and Stiffness}
We reframe the interpretation of Dynamic Proportionality from thermodynamics to \textbf{Dynamical Systems Theory}. We posit that the gene regulatory network (GRN) moves on a quasi-potential landscape $U(\mathbf{y})$.
In a stable state (homeostasis), the system resides in a deep basin of attraction. Approximating the potential as a harmonic oscillator:
\begin{equation}
    U(y) \approx \frac{1}{2} k (y - \theta)^2
\end{equation}
The variance of the log-ratio is inversely proportional to the stiffness $k$ of the regulatory restoring force:
\begin{equation}
    \text{var}(y) \propto \frac{1}{k}
\end{equation}

\subsection{Dynamic Instability as a Metric of Phase Transition}
Consequently, our metric $\Phi(t)$ serves as a proxy for the \textbf{Inverse Regulatory Stiffness} ($k^{-1}$).
\begin{itemize}
    \item \textbf{Homeostasis ($\Phi \approx 0$):} High stiffness ($k \gg 0$). Strong repression minimizes transcriptional noise.
    \item \textbf{Transition ($\Phi \gg 0$):} Loss of stiffness ($k \to 0$). The system traverses a ``saddle point'' (flattened landscape) to facilitate phenotypic rewiring \citep{scheffer2009}.
\end{itemize}
Thus, DyProp identifies network events not by expression level, but by the collapse of regulatory constraints.

\begin{thebibliography}{9}

\bibitem{aitchison1986}
Aitchison, J. (1986).
\textit{The Statistical Analysis of Compositional Data}. Chapman and Hall.

\bibitem{martin2015}
Martín-Fernández, J.A., et al. (2015).
Multiplicative replacement for general zero values. \textit{Biometrika}, 102(2).

\bibitem{quinn2017}
Quinn, T.P., et al. (2017).
propr: An R-package for identifying proportionally abundant features. \textit{Scientific Reports}, 7.

\bibitem{verhulst1838}
Verhulst, P.F. (1838).
Notice sur la loi que la population suit dans son accroissement.

\bibitem{scheffer2009}
Scheffer, M., et al. (2009).
Early-warning signals for critical transitions. \textit{Nature}, 461.

\end{thebibliography}

\end{document}